generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id            String          @id @default(cuid())
  githubId      String          @unique
  githubLogin   String
  email         String?
  name          String?
  avatarUrl     String?
  accessToken   String?
  createdAt     DateTime        @default(now())
  accountAge    DateTime
  TokenizedRepo TokenizedRepo[]
  ClaimedRepos  TokenizedRepo[] @relation("ClaimedBy")

  @@index([githubLogin])
}

model LaunchAttempt {
  id           String   @id @default(cuid())
  repoId       String
  repoFullName String
  userId       String
  status       String
  errorMessage String?
  createdAt    DateTime @default(now())

  @@index([userId])
  @@index([repoId])
}

model TokenizedRepo {
  id              String   @id
  repoId          String   @unique
  repoName        String
  repoFullName    String
  repoDescription String?
  repoUrl         String
  repoStars       Int      @default(0)
  repoForks       Int      @default(0)
  tokenName       String
  tokenSymbol     String
  tokenMint       String   @unique
  metadataUri     String
  logoUri         String?
  bannerUri       String?
  bondingCurve    String?
  transactionSig  String
  userId          String
  launchedAt      DateTime @default(now())
  User            User     @relation(fields: [userId], references: [id])
  
  // Fee tracking for non-owner launches
  // When launcher != repo owner, fees accumulate for real owner to claim
  isEscrow          Boolean   @default(false)  // true = launched by non-owner
  isClaimed         Boolean   @default(false)  // true = real owner claimed fees
  claimedAt         DateTime?
  claimedByUserId   String?
  claimedByWallet   String?
  ClaimedBy         User?     @relation("ClaimedBy", fields: [claimedByUserId], references: [id])
  
  // Fee calculation tracking (calculated from trading volume)
  // pump.fun creator fee = 0.5% of trading volume
  totalFeesEarned   Float     @default(0)      // Total SOL earned from fees (calculated)
  totalFeesClaimed  Float     @default(0)      // SOL already claimed by owner
  lastFeeUpdate     DateTime?                   // Last time we updated fee calculation

  @@index([repoFullName])
  @@index([tokenMint])
  @@index([userId])
}
